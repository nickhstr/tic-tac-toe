function TicTacToe(t){this.init(t)}function playerOrComputerFirst(){var t=Math.round(Math.random());return 0===t?"Player":"Computer"}function startGame(t){window.tictactoe=new TicTacToe(t),tictactoe.showBoard(!0)}TicTacToe.prototype.getCurrentState=function(){return this.state[this.state.length-1]},TicTacToe.prototype.reset=function(t){this.init({marker:null,player:null,reset:!0}),this.showBoard(!1)},TicTacToe.prototype.init=function(t){this.state=[],this.squares=elsByClass("square"),this.startForm=elById("startForm"),this.game=elById("game"),this.title=elById("title"),this.computerDelay=750,this.playerTab=elById("playerTab"),this.computerTab=elById("computerTab"),this.winOrDrawTab=elById("winOrDrawTab");var r=Array.prototype.slice.call(this.squares,0,3),e=Array.prototype.slice.call(this.squares,3,6),a=Array.prototype.slice.call(this.squares,6);this.rows=[r,e,a];var n={activePlayer:t.player,playerMarker:t.marker,currentBoard:this.freshBoard(),winningMove:!1,draw:!1,winner:null,playerWinCount:parseInt(localStorage.getItem("playerWinCount")),computerWinCount:parseInt(localStorage.getItem("computerWinCount")),reset:t.reset};this.updateState({type:"add",newState:n})},TicTacToe.prototype.nextGame=function(){var t=this.getCurrentState(),r=Object.assign({},t,{winner:null,winningMove:!1,draw:!1,currentBoard:this.freshBoard(),playerWinCount:parseInt(localStorage.getItem("playerWinCount")),computerWinCount:parseInt(localStorage.getItem("computerWinCount"))});this.updateState({type:"add",newState:r})},TicTacToe.prototype.updateState=function(t){switch(t.type){case"add":this.state.push(t.newState)}this.notify()},TicTacToe.prototype.notify=function(){this.notifySquares(),this.notifyTurn(),this.notifyWinCounts()},TicTacToe.prototype.notifySquares=function(){for(var t=this.getCurrentState(),r=t.currentBoard,e=(t.winningMove,0);e<r.length;e++)for(var a=0;a<r[e].length;a++)this.rows[e][a].innerHTML=r[e][a]},TicTacToe.prototype.notifyTurn=function(){var t=this.getCurrentState();"Computer"!==t.activePlayer||t.winningMove||t.draw?t.winningMove||t.draw||t.reset?(this.updateHandlers(!1),this.computerTab.className="hide-edge",this.playerTab.className="hide-edge",t.winningMove?this.updateWinOrDraw(t.winner+" wins!"):t.draw?this.updateWinOrDraw("It's a draw!"):t.reset&&this.updateWinOrDraw()):(this.updateHandlers(!0),this.computerTab.className="hide-edge",this.playerTab.className=""):(this.updateHandlers(!1),this.computerTurn(),this.computerTab.className="",this.playerTab.className="hide-edge")},TicTacToe.prototype.notifyWinCounts=function(){var t=this.getCurrentState(),r=t.winner;if("Player"===r){var e=t.playerWinCount+1;return localStorage.setItem("playerWinCount",e)}if("Computer"===r){var a=t.computerWinCount+1;return localStorage.setItem("computerWinCount",a)}},TicTacToe.prototype.updateWinOrDraw=function(t){var r=this;t?(this.winOrDrawTab.innerHTML=t,this.winOrDrawTab.className="",setTimeout(function(){r.winOrDrawTab.className="hide-win-draw",r.winOrDrawTab.innerHTML="",r.nextGame()},2e3)):(this.winOrDrawTab.innerHTML="",this.winOrDrawTab.className="hide-win-draw")},TicTacToe.prototype.updatedBoard=function(t,r){for(var e=this.getCurrentState(),a=e.playerMarker,n=e.currentBoard,i=[],o=0;o<n.length;o++)i.push(n[o].concat());return i[t][r]=a,i},TicTacToe.prototype.freshBoard=function(){return[[null,null,null],[null,null,null],[null,null,null]]},TicTacToe.prototype.computerScan=function(){var t=this.getCurrentState().playerMarker,r=this.lookForWin(t);if(r)return this.computerTakeTurn(r[0],r[1]);var e=this.lookForBlock();if(e)return this.computerTakeTurn(e[0],e[1]);var a=this.otherwiseChoose();return this.computerTakeTurn(a[0],a[1])},TicTacToe.prototype.lookForWin=function(t){for(var r,e,a=this.getCurrentState(),n=a.currentBoard,i=0;i<3;i++){for(var o=0,u=0;u<3;u++)n[i][u]===t&&o++;if(2===o&&n[i].indexOf(null)>-1)return r=i,e=n[i].indexOf(null),[r,e]}for(var i=0;i<3;i++){for(var o=0,u=0;u<3;u++)n[u][i]===t&&o++;if(2===o){e=i;for(var u=0;u<3;u++)if(null===n[u][i]){r=u;break}if(r>-1)return[r,e]}}if(null===n[1][1]&&(n[0][0]===t&&n[2][2]===t||n[0][2]===t&&n[2][0]===t))return[1,1];if(n[1][1]===t){if(null===n[0][0]&&n[2][2]===t)return[0,0];if(n[0][0]===t&&null===n[2][2])return[2,2];if(null===n[0][2]&&n[2][0]===t)return[0,2];if(n[0][2]===t&&null===n[2][0])return[2,0]}return!1},TicTacToe.prototype.lookForBlock=function(){var t=this.getCurrentState(),r="x"===t.playerMarker?"o":"x";return this.lookForWin(r)},TicTacToe.prototype.otherwiseChoose=function(){for(var t=this.getCurrentState(),r=t.currentBoard,e=t.playerMarker,a="x"===t.playerMarker?"o":"x",n=0;n<3;n++){for(var i=0,o=0,u=0;u<3;u++)r[n][u]===e?i++:r[n][u]===a&&o++;if(1===i&&0===o)return x=n,y=r[n].indexOf(null),[x,y]}for(var n=0;n<3;n++){for(var i=0,o=0,u=0;u<3;u++)r[u][n]===e?i++:r[u][n]===a&&o++;if(1===i&&0===o){y=n;for(var u=0;u<3;u++)if(null===r[u][n]){x=u;break}if(x>-1)return[x,y]}}for(var n=0;n<3;n++)for(var u=0;u<3;u++)if(null===r[n][u])return[n,u]},TicTacToe.prototype.computerTakeTurn=function(t,r){var e=this;setTimeout(function(){e.takeTurn(t,r)},this.computerDelay)},TicTacToe.prototype.computerTurn=function(){this.getCurrentState();1===this.state.length||this.isValidTurn(1,1)?this.computerTakeTurn(1,1):this.computerScan()},TicTacToe.prototype.isValidTurn=function(t,r){if(t>=0&&t<=2&&r>=0&&r<=2){var e=this.getCurrentState(),a=e,n=a.currentBoard[t][r];if(null===n)return!0}return!1},TicTacToe.prototype.isWinningTurn=function(t,r){var e=function(){for(var e=0;e<3;e++){var a=r.filter(function(r){return r[e]===t});if(3===a.length)return!0}return!1},a=function(){for(var e=0;e<3;e++){var a=r[e].filter(function(r){return r===t});if(3===a.length)return!0}return!1},n=function(){return r[1][1]===t&&(r[0][0]===t&&r[2][2]===t||r[2][0]===t&&r[0][2]===t)};return!!(n()||a()||e())},TicTacToe.prototype.isDraw=function(t){for(var r=0;r<3;r++)if(t[r].indexOf(null)>-1)return!1;return!0},TicTacToe.prototype.takeTurn=function(t,r){var e=this.getCurrentState(),a=!1;if(this.isValidTurn(t,r)){var n={activePlayer:"Computer"===e.activePlayer?"Player":"Computer",playerMarker:"x"===e.playerMarker?"o":"x",computerWinCount:e.computerWinCount,playerWinCount:e.playerWinCount,reset:e.reset};n.currentBoard=this.updatedBoard(t,r),n.winningMove=a=this.isWinningTurn(e.playerMarker,n.currentBoard),n.draw=!a&&this.isDraw(n.currentBoard),n.winner=a?e.activePlayer:null,this.updateState({type:"add",newState:n})}},TicTacToe.prototype.updateHandlers=function(t){t?Array.prototype.forEach.call(this.squares,function(t){t.onclick=function(t){var r=JSON.parse(this.dataset.cords),e=r[0],a=r[1];tictactoe.takeTurn(e,a)}}):Array.prototype.forEach.call(this.squares,function(t){t.onclick=null})},TicTacToe.prototype.showBoard=function(t){t?(this.startForm.className+=" hide-shrink",this.game.className=this.game.className.replace(/\s?(hide-down)\s?/,""),this.title.className=""):(this.startForm.className=this.startForm.className.replace(/\s?(hide-shrink)\s?/,""),this.game.className+=" hide-down",this.title.className="title-intro")},window.onload=function(t){elById("startForm").addEventListener("submit",function(t){t.preventDefault();var r=playerOrComputerFirst(),e=this.elements.marker.value;"Computer"===r&&(e="x"===e?"o":"x"),localStorage.getItem("playerWinCount")||(localStorage.setItem("playerWinCount","0"),localStorage.setItem("computerWinCount","0")),startGame({marker:e,player:r,reset:!1})})};
function elById(n){return document.getElementById(n)}function elsByClass(n){return document.getElementsByClassName(n)}"function"!=typeof Object.assign&&!function(){Object.assign=function(n){"use strict";if(void 0===n||null===n)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(n),t=1;t<arguments.length;t++){var o=arguments[t];if(void 0!==o&&null!==o)for(var r in o)o.hasOwnProperty(r)&&(e[r]=o[r])}return e}}();